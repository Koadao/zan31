<!DOCTYPE html>
    <html lang="en">
    <!-- declare empty favicon (firefox issue)-->
    <link rel="icon" href="data:,">

<html>
    <head>

        <!-- leaflet set up -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>


        <!-- embededd css-->
        <style>
            body {
                padding: 0;
                margin: 0;
            }
            html, body, #map {
                height: 100%;
                width: 100%;
            }
        </style>
       
        <title>Potentiel mutable Ã  vocation d'habitat</title>
        
    </head>
    <body>

        <div id="map"></div>
        <!-- Add jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <!-- Add geoltoobox -->
        <script type="module" src="https://cdn.jsdelivr.net/npm/geotoolbox/src/index.js" charset="utf-8"></script>
        <!-- embedded javascript -->

        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

        <script>

            function getColorarray(d, distribution) {
                return d > distribution[6] ? '#800026' :
                    d > distribution[5]  ? '#BD0026' :
                    d > distribution[4]   ? '#E31A1C' :
                    d > distribution[3]  ? '#FC4E2A' :
                    d > distribution[2]   ? '#FD8D3C' :
                    d > distribution[1]   ? '#FEB24C' :
                    d > distribution[0]   ? '#FED976' :
                                        '#9002d0'; 
            }


            function calculateEqualIntervals(values, numClasses) 
            {
                // Step 1: Find the minimum and maximum values in the data
                const minValue = Math.min(...values);
                const maxValue = Math.max(...values);

                // Step 2: Calculate the range of the data
                const range = maxValue - minValue;

                // Step 3: Calculate the size of each interval
                const intervalSize = range / numClasses;

                // Step 4: Initialize an array to store the class breaks
                const classBreaks = [];

                // Step 5: Calculate the class breaks
                for (let i = 0; i <= numClasses; i++) {
                    const classBreak = minValue + i * intervalSize;
                    classBreaks.push(classBreak);
                }

                return classBreaks;
            }
            
            var area_filter = 700
            var parcels = $.ajax({
            url:"parcelle_4326.geojson",
            dataType: "json",
            success: console.log("Parcels data successfully loaded."),
            error: function (xhr) {
                alert(xhr.statusText)
            }
            })
            // Specify that this code should run once the county data request is complete
            $.when(parcels).done(function() {
            //select values
            let values = parcels.responseJSON.features.map(feature => feature.properties['i_mutli_crit']);
            console.log("i_mutli_crit", values);
            //Apply equal fonction
            let EqualInt = calculateEqualIntervals(values, 7)
            console.log("Distrib equal", EqualInt);


            function style(feature) // param EqualInt ?
            {
                return {
                    fillColor: getColorarray(feature.properties.i_mutli_crit,EqualInt),//EqualInt),breaks_jenks),
                    weight: 2,
                    opacity: 0.2,
                    color: 'white',
                    //dashArray: '3',
                    fillOpacity: 0.7
                };
            }

            var map = L.map('map').setView([43.6013, 1.4447], 11);//Haute-Garonne

            var basemap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            L.geoJSON(parcels.responseJSON,{style: style}).addTo(map);

            //let data_set = fetch("parcelle_4326.geojson");
            //let data =  data_set.json();
            //L.geoJSON(data).addTo(map);
            //console.log("%j", data);

            var parcels_filtered = geo.properties.select({
                x: parcels.responseJSON, // a GeoJSON object
                expression: "par_area > ${area_filter}" // an expression (string) 
            })
            console.log("parcels_filtered", parcels_filtered);

            //var parcels_filtered = geo.filter(parcels_unfiltered, (d) => d.area > area_filter)


            
            });//end of Specify

        </script>
    </body>
</html>